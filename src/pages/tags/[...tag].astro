---
const { tag } = Astro.params;

import { getCollection } from "astro:content";
import GeneralPageLayout from "../../layouts/GeneralPageLayout.astro";
import PostsTable from "../../components/PostsTable.astro";


export async function getStaticPaths() {
  const posts = await getCollection("posts");
  return [...new Set(posts.map((p) => p.data.tags).flat())].map(
    (t) => ({
      params: { tag: t },
    }),
  );
}

const allPostsWithTag = await getCollection("posts", (post) =>
  post.data.tags.some((t) => t === tag),
);

---

<GeneralPageLayout pageTitle=`Tag: "${tag}"` headingText={`Posts tagged with "${tag}"`}>
    <PostsTable posts={allPostsWithTag} class="mt-5" />
</GeneralPageLayout>